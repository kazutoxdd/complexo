-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
vSERVER = Tunnel.getInterface("chest")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local chestOpen = ""
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHESTCOORDS
-----------------------------------------------------------------------------------------------------------------------------------------
local chestCoords = {

	-- Legal
	{ "State",360.43,-1600.48,25.83,"1" }, -- dp dip
	{ "PoliceS",-944.92,-2040.84,9.4,"1" }, --dp aeroporto
	{ "PoliceCore",833.52,-1300.53,24.31,"1" }, --dpcore
	{ "Sheriff2",1848.9,3687.88,34.26,"1" }, --paleto
	{ "Sheriff",-450.77,6011.15,31.71,"1" }, --dp paleto
	{ "Comanf",383.85,793.89,190.49,"1" }, --dp comanf
	{ "Corrections",1844.31,2573.84,46.26,"1" },
	{ "Paramedic",-670.81,327.3,88.01,"1" },
	{ "Paramedic",-670.77,328.03,88.01,"1" },

	--Cupula
	{"Cupula",-5867.09,1146.99,13.19,"1"},

	-- Bennys
	{ "Bennys",840.15,-930.92,20.29,"1" },

	-- Ilegal
	{ "Motoclub",977.1,-104.16,74.85,"1" },
	{ "Ballas",105.37,-1996.53,14.88,"1" },
	{ "Vagos",428.34,-2050.18,18.74,"1" },
	{ "Salieris",426.43,-1501.96,33.8,"1" },
	{ "FavelaDK",-132.87,2761.59,58.06,"1" },
	{ "Vinhedo",-1861.72,2054.71,135.46,"1" },
	{ "Fazenda",1403.21,1152.59,114.33,"1" },
	{ "Grota",1274.47,-195.86,108.01,"1" },
	{ "FavelaNH",2248.62,49.97,251.42,"1" },
	{ "FavelaSV",1778.14,468.47,174.31,"1" },
	{ "Pedreira",2995.65,3031.73,105.73,"1" },
	{ "Chacara",2444.09,4966.96,46.81,"1" },
	{ "Arcade",-571.62,289.01,79.18,"1" },
	{ "Vanilla",93.93,-1291.06,29.27,"1" },
	{ "Cosanostra",-1790.05,420.02,128.6,"1" },
	{ "Bahamas",-1369.12,-624.47,30.31,"1" },
	{ "PlayBoy",-1519.75,115.84,50.04,"1" },
	{ "Yakuza",2550.86,3874.22,37.32,"1" },
	{ "Duros",1970.13,3815.02,33.43,"1" },
	{ "Primatas",-74.39,6509.37,31.26,"1" },
	{ "BLX",-638.08,949.23,243.95,"1" },
	{ "HotGirls",1108.61,250.03,-45.85,"1" },
	{ "Bloods",-1076.54,-1679.38,4.58,"1" },
	{ "Crips",1274.87,-1712.26,54.76,"1" },
	{ "FerroVelho",-595.08,-1604.12,27.01,"1" },

	-- CASA DA LOLO
	{ "CasaLolo",1.1,529.73,170.62,"1" },
	
	-- Lideres e gerencia
	{ "LiderMotoclub",971.28,-99.01,74.85,"1" },
	{ "LiderPedreira",2995.94,3030.45,105.73,"1" },
	{ "LiderFavelaNH",2238.51,74.39,248.8,"1" },
	{ "LiderChacara",2443.43,4964.47,46.81,"1" },
	{ "LiderVanilla",92.38,-1291.79,29.27,"1" },
	{ "LiderBahamas",-1365.49,-616.97,30.31,"1" },
	{ "LiderGrota",1277.27,-194.91,108.01,"1" },
	{ "LiderFavelaSV",1779.51,467.48,174.31,"1" },
	{ "LiderArcade",-576.21,291.37,79.18,"1" },
	{ "LiderSalieris",423.41,-1497.2,33.8,"1" },
	{ "LiderCosanostra",-1841.67,452.08,126.88,"1" },
	{ "LiderBallas",112.41,-1998.15,14.88,"1" },
	{ "LiderVagos",422.33,-2046.15,18.74,"1" },
	{ "LiderFavelaDK",-125.53,2752.46,58.22,"1" },
	{ "LiderVinhedo",-1864.03,2060.01,135.46,"1" },
	{ "LiderFazenda",1391.5,1158.97,114.33,"1" },
	{ "LiderPlayBoy",-1522.83,117.84,50.04,"1" },
	{ "LiderYakuza",2554.95,3875.16,37.32,"1" },
	{ "LiderPrimatas",-71.76,6512.02,31.26,"1" },
	{ "LiderBLX",-627.89,948.4,243.95,"1" },
	{ "LiderHotGirls",1114.87,243.95,-45.85,"1" },
	{ "LiderBloods",-1079.86,-1679.59,4.57,"1" },
	{ "LiderCrips",1273.56,-1720.12,54.76,"1" },
	{ "LiderFerroVelho",-598.25,-1610.05,27.01,"1" },
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHESTINFOS
-----------------------------------------------------------------------------------------------------------------------------------------
local chestInfos = {
	["1"] = {
		{
			event = "chest:openSystem",
			label = "Abrir",
			tunnel = "shop"
		},{
			event = "chest:upgradeSystem",
			label = "Aumentar",
			tunnel = "shop"
		}
	},
	["2"] = {
		{
			event = "chest:openSystem",
			label = "Bandeja",
			tunnel = "shop"
		}
	}
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADTARGET
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	SetNuiFocus(false,false)

	for k,v in pairs(chestCoords) do
		exports["target"]:AddCircleZone("Chest:"..k,vec3(v[2],v[3],v[4]),0.5,{
			name = "Chest:"..k,
			heading = 3374176,
			useZ = true
		},{
			shop = k,
			distance = 1.5,
			options = chestInfos[v[5]]
		})
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:OPENSYSTEM
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("chest:openSystem",function(shopId)
	if LocalPlayer["state"]["Route"] < 900000 then
		if vSERVER.Permissions(chestCoords[shopId][1]) and MumbleIsConnected() then
			SetNuiFocus(true,true)
			chestOpen = chestCoords[shopId][1]
			SendNUIMessage({ action = "showMenu" })
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:UPGRADESYSTEM
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("chest:upgradeSystem",function(shopId)
	if MumbleIsConnected() then
		vSERVER.upgradeSystem(chestCoords[shopId][1])
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHESTCLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("invClose",function()
	SendNUIMessage({ action = "hideMenu" })
	SetNuiFocus(false,false)
	chestOpen = ""
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TAKEITEM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("takeItem",function(data)
	if MumbleIsConnected() then
		vSERVER.takeItem(data["item"],data["slot"],data["amount"],data["target"],chestOpen)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- STOREITEM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("storeItem",function(data)
	if MumbleIsConnected() then
		vSERVER.storeItem(data["item"],data["slot"],data["amount"],data["target"],chestOpen)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATESLOT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("updateChest",function(data)
	if MumbleIsConnected() then
		vSERVER.updateChest(data["slot"],data["target"],data["amount"],chestOpen)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTCHEST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("requestChest",function(data,cb)
	local Inventory,Chest,invPeso,invMaxpeso,chestPeso,chestMaxpeso = vSERVER.openChest(chestOpen)
	if Inventory then
		cb({ Inventory = Inventory, Chest = Chest, invPeso = invPeso, invMaxpeso = invMaxpeso, chestPeso = chestPeso, chestMaxpeso = chestMaxpeso })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:UPDATE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chest:Update")
AddEventHandler("chest:Update",function(action)
	SendNUIMessage({ action = action })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:UPDATEWEIGHT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chest:UpdateWeight")
AddEventHandler("chest:UpdateWeight",function(invPeso,invMaxpeso,chestPeso,chestMaxpeso)
	SendNUIMessage({ action = "updateWeight", invPeso = invPeso, invMaxpeso = invMaxpeso, chestPeso = chestPeso, chestMaxpeso = chestMaxpeso })
end)